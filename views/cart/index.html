<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tu Carrito | Dulces La Tradici√≥n</title>
  <link rel="stylesheet" href="../styles/styles.css">
</head>
<!-- Bot√≥n flotante del carrito -->
<a href="../cart/index.html" class="boton-carrito-flotante" title="Ver carrito">
  üõí
  <span id="contadorCarrito">0</span>
</a>

<script src="../components/cart-badge.js"></script>

<body>
  <header>
    <h1>üõí Tu Carrito</h1>
    <nav>
      <a href="../home/index.html">Inicio</a>
      <a href="../productos/index.html">Productos</a>
    </nav>
  </header>

  <main class="carrito-container">
    <h2>Resumen de tu pedido</h2>
    <div id="listaCarrito"></div>
    <p id="total"></p>

    <div class="botones-carrito">
      <button id="vaciarCarrito">Vaciar carrito</button>
      <button id="finalizarCompra">Finalizar compra por WhatsApp</button>
    </div>
  </main>

  <footer>
    <p>¬© 2025 Dulces La Tradici√≥n. Todos los derechos reservados.</p>
  </footer>

  <script>
    const listaCarrito = document.getElementById('listaCarrito');
    const total = document.getElementById('total');
    const btnVaciar = document.getElementById('vaciarCarrito');
    const btnFinalizar = document.getElementById('finalizarCompra');
    let carrito = JSON.parse(localStorage.getItem('carrito')) || [];

    function mostrarCarrito() {
      listaCarrito.innerHTML = "";
      let totalCompra = 0;

      if (carrito.length === 0) {
        listaCarrito.innerHTML = "<p>Tu carrito est√° vac√≠o üò¢</p>";
        total.textContent = "";
        return;
      }

      carrito.forEach((item, index) => {
        totalCompra += item.precio * item.cantidad;
        const div = document.createElement('div');
        div.classList.add('item-carrito');
        div.innerHTML = `
          <img src="${item.imagen}" alt="${item.nombre}">
          <span>${item.nombre}</span>
          <span>$${item.precio.toFixed(2)}</span>
          <div class="cantidad">
            <button onclick="cambiarCantidad(${index}, -1)">-</button>
            <span>${item.cantidad}</span>
            <button onclick="cambiarCantidad(${index}, 1)">+</button>
          </div>
          <span>$${(item.precio * item.cantidad).toFixed(2)}</span>
          <button class="eliminar" onclick="eliminarProducto(${index})">‚ùå</button>
        `;
        listaCarrito.appendChild(div);
      });

      total.textContent = `Total: $${totalCompra.toFixed(2)}`;
    }

    function cambiarCantidad(index, delta) {
      carrito[index].cantidad += delta;
      if (carrito[index].cantidad <= 0) carrito.splice(index, 1);
      guardarYActualizar();
    }

    function eliminarProducto(index) {
      carrito.splice(index, 1);
      guardarYActualizar();
    }

    function guardarYActualizar() {
      localStorage.setItem('carrito', JSON.stringify(carrito));
      mostrarCarrito();
    }

    btnVaciar.addEventListener('click', () => {
      if (confirm("¬øVaciar todo el carrito?")) {
        carrito = [];
        guardarYActualizar();
      }
    });

    btnFinalizar.addEventListener('click', () => {
      const numero = "5804129066038";
      if (carrito.length === 0) {
        alert("Tu carrito est√° vac√≠o.");
        return;
      }

      let mensaje = "üõçÔ∏è *Pedido de Dulces La Tradici√≥n:*%0A%0A";
      carrito.forEach(item => {
        mensaje += `üç¨ ${item.nombre} x${item.cantidad} = $${(item.precio * item.cantidad).toFixed(2)}%0A`;
      });

      const totalCompra = carrito.reduce((acc, p) => acc + p.precio * p.cantidad, 0);
      mensaje += `%0Aüí∞ *Total:* $${totalCompra.toFixed(2)}%0A%0AüìçPor favor, confirma tu pedido.`;

      const url = `https://wa.me/${numero}?text=${mensaje}`;
      window.open(url, "_blank");
    });

    mostrarCarrito();
  </script>
</body>
</html>
