<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dulces La Tradici√≥n - Sabores Artesanales</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="../styles/output.css">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>

<!-- HEADER -->
<header class="bg-amber-50 shadow-md">
  <div class="container mx-auto flex items-center justify-between py-4 px-4">

    <!-- LOGO -->
    <h1 class="text-2xl font-bold text-amber-800">
      üç™ Dulces La Tradici√≥n
    </h1>

    <!-- ICONOS -->
    <div class="flex items-center gap-10">

      <!-- CARRITO -->
      <a href="../cart/index.html"
        class="flex items-center gap-2 text-amber-800 hover:text-amber-600 transition relative">
        <i class="fa-solid fa-cart-shopping text-lg text-amber-700"></i>

        <span id="cart-count"
          class="absolute -top-2 -right-7 bg-red-600 text-white text-xs font-bold px-2 py-0.5 rounded-full hidden">
          0
        </span>
      </a>

      <!-- LOGIN -->
      <a href="../login/"
        class="flex items-center gap-2 text-amber-800 hover:text-amber-600 transition">
        <i class="fa-solid fa-user text-lg text-amber-700"></i>
        <span>Login</span>
      </a>

    </div>

  </div>
</header>

<!-- HERO -->
<section class="hero-section text-center py-16 bg-[url(https://i.ibb.co/qY08Kck0/GALLETAS-POLVOROSAS-CON-TUBITO.png)] bg-cover bg-center">
  <h1 class="text-4xl font-bold text-amber-900 mb-4" style="color: #92400e;">Delicias Artesanales</h1>
  <p class="text-lg text-amber-700 mb-6" style="color: #92400e;">
    El sabor casero que te conecta con los mejores momentos en familia.
  </p>

  <a href="#productos"
    class="bg-amber-700 text-white px-5 py-2 rounded-lg hover:bg-amber-600 transition">
    Descubre Nuestros Productos
  </a>
</section>

<!-- PRODUCTOS DIN√ÅMICOS -->
<section class="productos-section p-8 text-center" id="productos">
  <h2 class="text-3xl font-semibold mb-6 text-amber-800">Nuestros Dulces M√°s Populares</h2>

  <!-- CONTENEDOR DIN√ÅMICO -->
  <div id="productos-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- AQU√ç SE INSERTAN LOS PRODUCTOS DESDE LA API -->
  </div>
</section>

<!-- FOOTER -->
<footer class="p-4 bg-amber-100 text-center text-amber-800">
  <p>¬© 2025 Dulces La Tradici√≥n. Todos los derechos reservados.</p>
  <p>Elaborado por <strong>Josue Chirivi</strong> ‚Äî
    <a href="https://github.com/chirivt" class="text-amber-700 hover:underline" target="_blank">
      github.com/chirivt
    </a>
  </p>
</footer>

<script>
// ==========================================================
//  CONFIG
// ==========================================================
const API_URL = "/api/productos";

// ==========================================================
//  CARGAR PRODUCTOS DIN√ÅMICOS
// ==========================================================
document.addEventListener("DOMContentLoaded", () => {
  cargarProductos();
  actualizarContador();
});

async function cargarProductos() {
  const { data: productos } = await axios.get(API_URL);

  const contenedor = document.getElementById("productos-container");
  contenedor.innerHTML = "";

  productos.forEach(p => {
    contenedor.innerHTML += `
      <div class="producto-card border rounded-lg p-4 shadow hover:shadow-lg transition">
        <img src="${p.imagen}" alt="${p.nombre}"
          class="mx-auto rounded-lg w-48 h-48 object-cover mb-3">

        <h3 class="text-xl font-semibold text-amber-800">${p.nombre}</h3>
        <p class="text-amber-700">${p.descripcion || ""}</p>

        <span class="price block text-lg font-bold mt-2 text-amber-800">
          $${p.precio.toFixed(2)}
        </span>

        <button
          class="btn add-to-cart bg-amber-700 text-white mt-3 px-4 py-2 rounded-lg hover:bg-amber-600 transition w-full"
          data-nombre="${p.nombre}"
          data-precio="${p.precio}"
          data-imagen="${p.imagen}">
          A√±adir al carrito
        </button>
      </div>
    `;
  });

  activarBotonesCarrito();
}

// ==========================================================
//  CARRITO LOCALSTORAGE
// ==========================================================
function activarBotonesCarrito() {
  document.querySelectorAll(".add-to-cart").forEach(btn => {
    btn.addEventListener("click", () => {
      const producto = {
        nombre: btn.dataset.nombre,
        precio: parseFloat(btn.dataset.precio),
        imagen: btn.dataset.imagen,
        cantidad: 1
      };

      let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
      const index = carrito.findIndex(p => p.nombre === producto.nombre);

      if (index !== -1) carrito[index].cantidad++;
      else carrito.push(producto);

      localStorage.setItem("carrito", JSON.stringify(carrito));

      actualizarContador();
    });
  });
}

function actualizarContador() {
  const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
  const total = carrito.reduce((s, p) => s + p.cantidad, 0);

  const badge = document.getElementById("cart-count");

  if (total > 0) {
    badge.classList.remove("hidden");
    badge.textContent = total;
  } else {
    badge.classList.add("hidden");
  }
}

</script>

<script src="index.js"></script>
<script type="module" src="../components/notification.js"></script>

</body>
</html>
